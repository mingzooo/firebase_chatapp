(this.webpackJsonpfirebase_chat_app=this.webpackJsonpfirebase_chat_app||[]).push([[0],{29:function(e,t,c){},44:function(e,t,c){},54:function(e,t,c){"use strict";c.r(t);var n=c(3),a=c.n(n),s=c(32),i=c.n(s),o=(c(44),c(33)),r=c(34),l=c(38),d=c(36),j=c(17),u=c(9),h=c(5),b=(c(29),c(26)),f=b.a.initializeApp({apiKey:"AIzaSyAEqoY1owwwhvHoy5zTVZ3sJWryRtY4KSA",authDomain:"fb-chatapp1999.firebaseapp.com",projectId:"fb-chatapp1999",storageBucket:"fb-chatapp1999.appspot.com",messagingSenderId:"23101647682",appId:"1:23101647682:web:1885de1ef6cc789324f6db",measurementId:"G-DT4X9WTE43"}),O=f.firestore(),m=c(2),p=function(e){var t=e.show;return Object(m.jsx)("div",{className:"posFx vw100 vh100 aic jcc ".concat(t?"flex":"dNone"),children:Object(m.jsx)("div",{className:"spinner loader"})})},x=function(){var e=Object(u.f)(),t=Object(n.useState)(""),c=Object(h.a)(t,2),a=c[0],s=c[1],i=Object(n.useState)(""),o=Object(h.a)(i,2),r=o[0],l=o[1],d=Object(n.useState)(""),j=Object(h.a)(d,2),x=j[0],v=j[1],g=Object(n.useState)(!1),N=Object(h.a)(g,2),w=N[0],C=N[1],S=Object(n.useState)(!1),_=Object(h.a)(S,2),k=(_[0],_[1]),y=Object(n.useState)(""),E=Object(h.a)(y,2),I=(E[0],E[1]);return Object(n.useEffect)((function(){f.auth().onAuthStateChanged((function(t){var c=(f.auth().currentUser||{}).uid;c&&(k(!0),I(c),e.push("/app"))}))}),[]),Object(m.jsxs)("div",{children:[Object(m.jsx)(p,{show:w}),Object(m.jsx)("div",{className:"flex aic jcc vh100",children:Object(m.jsxs)("div",{className:"w400",children:[Object(m.jsxs)("div",{className:"fdr aic pt16",children:[Object(m.jsx)("div",{className:"w100",children:Object(m.jsx)("span",{children:"NickName"})}),Object(m.jsx)("input",{onChange:function(e){v(e.target.value)},className:"default_input f1",placeholder:"nickname",value:x})]}),Object(m.jsxs)("div",{className:"fdr aic pt16",children:[Object(m.jsx)("div",{className:"w100",children:Object(m.jsx)("span",{children:"email"})}),Object(m.jsx)("input",{onChange:function(e){s(e.target.value)},className:"default_input f1",placeholder:"email",value:a})]}),Object(m.jsxs)("div",{className:"fdr aic pt16",children:[Object(m.jsx)("div",{className:"w100",children:Object(m.jsx)("span",{children:"password"})}),Object(m.jsx)("input",{onChange:function(e){l(e.target.value)},className:"default_input f1",placeholder:"password",type:"password",value:r})]}),Object(m.jsx)("div",{className:"jcc flex pt16 pb16"}),Object(m.jsx)("div",{onClick:function(){a.length<3?alert("!!!"):(C(!0),f.auth().createUserWithEmailAndPassword(a,r).then((function(t){var c=(f.auth().currentUser||{}).uid;console.log(c),c?O.collection("google").add({uid:c,nickName:x,age:20,email:a,created:b.a.firestore.Timestamp.now().seconds}).then((function(t){k(!0),I(c),s(""),l(""),e.push("/createChat"),C(!1)})):alert("error")})).catch((function(e){C(!1);e.code,e.message})))},className:"btn btn-success btn-fit",children:"Signup"})]})})]})},v=function(){var e=Object(u.f)(),t=Object(n.useState)(""),c=Object(h.a)(t,2),a=c[0],s=c[1],i=Object(n.useState)(""),o=Object(h.a)(i,2),r=o[0],l=o[1],d=Object(n.useState)(!1),j=Object(h.a)(d,2),b=j[0],O=j[1],x=Object(n.useState)(!1),v=Object(h.a)(x,2),g=v[0],N=v[1],w=Object(n.useState)(!1),C=Object(h.a)(w,2),S=C[0],_=C[1];Object(n.useEffect)((function(){f.auth().onAuthStateChanged((function(t){O(!0),(f.auth().currentUser||{}).uid&&(_(!0),e.push("/createChat"))}))}),[]);return b?Object(m.jsxs)("div",{children:[Object(m.jsx)(p,{show:g}),S?Object(m.jsx)(m.Fragment,{children:Object(m.jsx)("div",{className:"btn btn-danger",onClick:function(e){f.auth().signOut(),_(!1)},children:"logout"})}):Object(m.jsx)(m.Fragment,{children:Object(m.jsx)("div",{className:"flex aic jcc vh100",children:Object(m.jsxs)("div",{className:"w400",children:[Object(m.jsxs)("div",{className:"fdr aic",children:[Object(m.jsx)("div",{className:"w100",children:Object(m.jsx)("span",{children:"email"})}),Object(m.jsx)("input",{onChange:function(e){s(e.target.value)},className:"default_input f1",placeholder:"email",value:a})]}),Object(m.jsxs)("div",{className:"fdr aic pt16",children:[Object(m.jsx)("div",{className:"w100",children:Object(m.jsx)("span",{children:"password"})}),Object(m.jsx)("input",{onChange:function(e){l(e.target.value)},className:"default_input f1",placeholder:"password",type:"password",value:r})]}),Object(m.jsx)("div",{className:"pt16",children:Object(m.jsx)("div",{className:"btn btn-success btn-fit",onClick:function(t){a.length<3?alert("too short"):(N(!0),f.auth().signInWithEmailAndPassword(a,r).then((function(t){(f.auth().currentUser||{}).uid?(_(!0),s(""),l(""),e.push("/createChat"),N(!1)):(alert("error"),N(!1))})).catch((function(e){N(!1);var t=e.code;e.message,"auth/user-not-found"===t&&alert("\uac00\uc785\ud558\uc138\uc694")})))},children:"Login"})}),Object(m.jsx)("div",{className:"jcc flex pt16 pb16",children:Object(m.jsx)("span",{children:"or"})}),Object(m.jsx)("div",{onClick:function(){e.push("/signup")},className:"btn btn-default btn-fit",children:"Signup"})]})})})]}):Object(m.jsx)(m.Fragment,{})},g=c(37),N=c(21),w=c(15),C=a.a.memo((function(e){var t=e.chat,c=e.users,n=e.index,a=e.uid,s=e.onEmojiClick,i=function(e){var c=e.emojiKey,n=e.emojiValue,i=e.emojiObj,o="";return i&&i[c]&&i[c].includes(a)&&(o="active"),Object(m.jsx)("div",{children:Object(m.jsxs)("div",{onClick:function(e){return s(c,t.id)},className:"emojiRec flex fdr aic ".concat(o),children:[Object(m.jsx)("span",{children:n}),Object(m.jsx)("span",{children:i&&i[c]&&Object(m.jsx)("div",{children:i[c].length})})]})})};return Object(m.jsxs)("div",{className:"flex fdr pb16 chat_card",children:[Object(m.jsx)("div",{className:"w40 h40 flex aic jcc",children:Object(m.jsx)("img",{src:"http://www.gravatar.com/avatar/3b3be63a4c2a439b013787725dfce802?d=identicon",className:"w30 h30"})}),Object(m.jsxs)("div",{className:"pl16 f1",children:[Object(m.jsxs)("div",{children:[Object(m.jsx)("span",{className:"bold",children:function(){var e=c[t.uid];return e?e.nickName:"\uc775\uba85"}()}),"  "]}),Object(m.jsx)("div",{className:"pt8",children:t.content}),function(){var e=t.emoji;return Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)("div",{className:"fdr",children:[Object(m.jsx)(i,{emojiKey:"1",emojiValue:"\ud83d\ude0e",emojiObj:e}),Object(m.jsx)(i,{emojiKey:"2",emojiValue:"\ud83e\udd23",emojiObj:e})]})})}()]})]},n)}),(function(e,t){return e.chat===t.chat&&e.users===t.users})),S=a.a.memo((function(e){var t=e.chats,c=e.users,n=e.uid,a=e.onEmojiClick;return Object(m.jsx)(m.Fragment,{children:t.map((function(e){return Object(m.jsx)("div",{children:Object(m.jsx)(C,{chat:e,users:c,uid:n,index:e.id,onEmojiClick:a})},e.id)}))})}),(function(e,t){return e.chats===t.chats&&e.users===t.users})),_=function(e){var t=Object(u.f)(),c=Object(n.useState)([]),a=Object(h.a)(c,2),s=a[0],i=a[1],o=Object(n.useState)(""),r=Object(h.a)(o,2),l=r[0],d=r[1],j=Object(n.useState)(""),p=Object(h.a)(j,2),x=p[0],v=p[1],C=Object(n.useState)({}),_=Object(h.a)(C,2),k=_[0],y=_[1],E=Object(u.g)().channelId,I=Object(n.useRef)(null),F=Object(n.useState)(null),A=Object(h.a)(F,2),B=A[0],T=A[1],U=Object(n.useState)(""),L=Object(h.a)(U,2),V=L[0],K=L[1],P=Object(n.useState)(""),R=Object(h.a)(P,2),W=R[0],Y=R[1],z=Object(n.useMemo)((function(){return console.log("use memo"),Object(m.jsxs)("div",{children:[V," - ",W]})}),[W]);Object(n.useEffect)((function(){f.auth().onAuthStateChanged((function(e){var t=(f.auth().currentUser||{}).uid;t?d(t):window.location="/login"}))}),[]);Object(n.useEffect)((function(){!function(){var e;null===(e=I.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}()}),[s]);Object(n.useEffect)((function(){O.collection("chat").doc("room_"+E).collection("messages").orderBy("created").get().then((function(e){var t=e.docs.map((function(e){return Object(N.a)({id:e.id},e.data())}));i(t)}))}),[]),Object(n.useEffect)((function(){O.collection("chat").doc("room_"+E).collection("messages").orderBy("created").onSnapshot((function(e){e.docChanges().forEach((function(e){if("added"===e.type){var t=e.doc.data();t.id=e.doc.id,T(t)}if("modified"===e.type){var c=e.doc.data();c.id=e.doc.id,T(c)}"removed"===e.type&&console.log("remove message: ",e.doc.data())}))}))}),[]);var D=Object(n.useMemo)((function(){if(console.log("chat records use memo"),!B)return s;var e=Object(g.a)(s),t=e.findIndex((function(e){return e.id===B.id}));return-1===t?e.push(B):(B.id=e[t].id,e[t]=B),i(e),e}),[B]);Object(n.useEffect)((function(){if(0!==s.length){var e=s.map((function(e){return e.uid})).filter((function(e,t,c){return c.indexOf(e)===t})),t=O.collection("user"),c={};t.where("uid","in",e).get().then((function(e){e.forEach((function(e){var t=e.data();c[t.uid]=t})),y(c)}))}}),[s]);return Object(m.jsxs)("div",{style:{position:"relative"},className:"vh100",children:[Object(m.jsx)("input",{value:V,onChange:function(e){K(e.target.value)}}),Object(m.jsx)("div",{onClick:function(){Y(V)},children:"??????"}),Object(m.jsx)("hr",{}),z,Object(m.jsxs)("div",{className:"flex fdr vh100",children:[Object(m.jsxs)("div",{className:"w200 bg_black p16",children:[Object(m.jsxs)("div",{className:"color_white flex fdr aic cursor_pointer",onClick:function(e){f.auth().signOut().then((function(){t.push("/login")}))},children:[Object(m.jsx)(w.b,{}),Object(m.jsx)("span",{className:"color_white pl8",children:"Logout"})]}),Object(m.jsxs)("div",{className:"color_white flex fdr aic cursor_pointer pt16",onClick:function(e){t.push("/createChat")},children:[Object(m.jsx)(w.a,{}),Object(m.jsx)("span",{className:"color_white pl8",children:"Create New Channel"})]})]}),Object(m.jsxs)("div",{className:"f1 pl16 pt16 pr",children:[Object(m.jsxs)("div",{style:{height:"calc(100% - 50px)",overflowY:"scroll",paddingBottom:50},children:[Object(m.jsx)(S,{chats:D,users:k,uid:l,onEmojiClick:function(e,t){var c=O.collection("chat").doc("room_"+E).collection("messages").doc(t);c.get().then((function(t){var n=t.data(),a=Object(N.a)({},n.emoji),s=a[e];s?s.includes(l)||s.push(l):s=[l],a[e]=s,c.update({emoji:a})}))}}),Object(m.jsx)("div",{style:{float:"left",clear:"both"},ref:I})]}),Object(m.jsxs)("div",{className:"posAb",style:{bottom:16,width:"calc(100% - 32px)",backgroundColor:"#dcdcdc"},children:[Object(m.jsx)("div",{className:"flex fdr",children:Object(m.jsx)("textarea",{className:"default_textarea f1 p8",placeholder:"send a message to this channel",value:x,onChange:function(e){!function(e){v(e.target.value)}(e)}})}),Object(m.jsx)("div",{className:"flex jce fdr",children:Object(m.jsx)("div",{className:"btn btn-success h40 w40",onClick:function(e){O.collection("chat").doc("room_"+E).collection("messages").add({uid:l,content:x,created:b.a.firestore.Timestamp.now().seconds}).then((function(e){v("")}))},children:Object(m.jsx)(w.c,{})})})]})]})]})]})},k=function(e){var t=Object(u.f)(),c=Object(n.useState)(""),a=Object(h.a)(c,2),s=a[0],i=a[1];return Object(m.jsxs)("div",{className:"vw100 vh100 flex aic jcc",children:[Object(m.jsx)("div",{className:"posFx top0 right0 p8",children:Object(m.jsxs)("div",{className:"flex fdr aic cursor_pointer",onClick:function(e){f.auth().signOut(),t.push("/login")},children:[Object(m.jsx)(w.b,{}),Object(m.jsx)("span",{children:"Logout"})]})}),Object(m.jsxs)("div",{className:"w400 flex fdr aic",children:[Object(m.jsx)("input",{className:"default_input f1",placeholder:"\ucc44\ub110 \uc774\ub984\uc744 \uc785\ub825\ud558\uc138\uc694.",value:s,onChange:function(e){!function(e){i(e.target.value)}(e)}}),Object(m.jsx)("div",{className:"btn btn-success ml16 w100",onClick:function(e){t.push("/chat/".concat(s))},children:"Start"})]})]})},y=function(){var e=Object(n.useState)(0),t=Object(h.a)(e,2),c=t[0],a=t[1];return Object(n.useEffect)((function(){console.log("use effect!!!!")}),0),Object(m.jsxs)(m.Fragment,{children:["gogo",Object(m.jsx)("br",{}),c,Object(m.jsx)("div",{onClick:function(){a((function(e){return e+1}))},children:"++"})]})},E=c(39),I=a.a.memo((function(e){var t=e.chats,c=e.users,n=e.uid,a=e.onEmojiClick;return Object(m.jsx)(m.Fragment,{children:t.map((function(e){return Object(m.jsx)("div",{children:Object(m.jsx)(C,{chat:e,users:c,uid:n,index:e.id,onEmojiClick:a})},e.id)}))})}),(function(e,t){return e.chats===t.chats&&e.users===t.users})),F=function(e){var t=Object(u.f)(),c=Object(E.a)([]),a=Object(h.a)(c,2),s=a[0],i=a[1],o=Object(n.useState)(""),r=Object(h.a)(o,2),l=r[0],d=r[1],j=Object(n.useState)(""),p=Object(h.a)(j,2),x=p[0],v=p[1],g=Object(n.useState)({}),C=Object(h.a)(g,2),S=C[0],_=C[1],k=Object(u.g)().channelId,y=Object(n.useRef)(null);Object(n.useEffect)((function(){f.auth().onAuthStateChanged((function(e){var t=(f.auth().currentUser||{}).uid;t?d(t):window.location="/login"}))}),[]);Object(n.useEffect)((function(){!function(){var e;null===(e=y.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}()}),[s]);Object(n.useEffect)((function(){O.collection("chat").doc("room_"+k).collection("messages").orderBy("created").onSnapshot((function(e){e.docChanges().forEach((function(e){if("added"===e.type){var t=e.doc.data();t.id=e.doc.id,i((function(e){e.push(t)}))}if("modified"===e.type){var c=e.doc.data();c.id=e.doc.id,i((function(t){var n=t.findIndex((function(t){return t.id===e.doc.id}));t[n]=c}))}"removed"===e.type&&console.log("remove message: ",e.doc.data())}))}))}),[]),Object(n.useEffect)((function(){if(0!==s.length){var e=s.map((function(e){return e.uid})).filter((function(e,t,c){return c.indexOf(e)===t})),t=O.collection("user"),c={};t.where("uid","in",e).get().then((function(e){e.forEach((function(e){var t=e.data();c[t.uid]=t})),_(c)}))}}),[s]);return Object(m.jsx)("div",{style:{position:"relative"},className:"vh100",children:Object(m.jsxs)("div",{className:"flex fdr vh100",children:[Object(m.jsxs)("div",{className:"w200 bg_black p16",children:[Object(m.jsxs)("div",{className:"color_white flex fdr aic cursor_pointer",onClick:function(e){f.auth().signOut().then((function(){t.push("/login")}))},children:[Object(m.jsx)(w.b,{}),Object(m.jsx)("span",{className:"color_white pl8",children:"Logout"})]}),Object(m.jsxs)("div",{className:"color_white flex fdr aic cursor_pointer pt16",onClick:function(e){t.push("/createChat")},children:[Object(m.jsx)(w.a,{}),Object(m.jsx)("span",{className:"color_white pl8",children:"Create New Channel"})]})]}),Object(m.jsxs)("div",{className:"f1 pl16 pt16 pr",children:[Object(m.jsxs)("div",{style:{height:"calc(100% - 50px)",overflowY:"scroll",paddingBottom:50},children:[Object(m.jsx)(I,{chats:s,users:S,uid:l,onEmojiClick:function(e,t){var c=O.collection("chat").doc("room_"+k).collection("messages").doc(t);c.get().then((function(t){var n=t.data(),a=Object(N.a)({},n.emoji),s=a[e];s?s.includes(l)||s.push(l):s=[l],a[e]=s,c.update({emoji:a})}))}}),Object(m.jsx)("div",{style:{float:"left",clear:"both"},ref:y})]}),Object(m.jsxs)("div",{className:"posAb",style:{bottom:16,width:"calc(100% - 32px)",backgroundColor:"#dcdcdc"},children:[Object(m.jsx)("div",{className:"flex fdr",children:Object(m.jsx)("textarea",{className:"default_textarea f1 p8",placeholder:"send a message to this channel",value:x,onChange:function(e){!function(e){v(e.target.value)}(e)}})}),Object(m.jsx)("div",{className:"flex jce fdr",children:Object(m.jsx)("div",{className:"btn btn-success h40 w40",onClick:function(e){O.collection("chat").doc("room_"+k).collection("messages").add({uid:l,content:x,created:b.a.firestore.Timestamp.now().seconds}).then((function(e){v("")}))},children:Object(m.jsx)(w.c,{})})})]})]})]})})},A=function(e){Object(l.a)(c,e);var t=Object(d.a)(c);function c(){return Object(o.a)(this,c),t.apply(this,arguments)}return Object(r.a)(c,[{key:"render",value:function(){return Object(m.jsx)(j.a,{children:Object(m.jsxs)(u.c,{children:[Object(m.jsx)(u.a,{exact:!0,path:"/",component:v}),Object(m.jsx)(u.a,{exact:!0,path:"/signup",component:x}),Object(m.jsx)(u.a,{exact:!0,path:"/createChat",component:k}),Object(m.jsx)(u.a,{exact:!0,path:"/login",component:v}),Object(m.jsx)(u.a,{exact:!0,path:"/chat/:channelId",component:_}),Object(m.jsx)(u.a,{exact:!0,path:"/chat_immer/:channelId",component:F}),Object(m.jsx)(u.a,{exact:!0,path:"/test",component:y})]})})}}]),c}(a.a.Component),B=function(e){e&&e instanceof Function&&c.e(3).then(c.bind(null,55)).then((function(t){var c=t.getCLS,n=t.getFID,a=t.getFCP,s=t.getLCP,i=t.getTTFB;c(e),n(e),a(e),s(e),i(e)}))};i.a.render(Object(m.jsx)(a.a.StrictMode,{children:Object(m.jsx)(A,{})}),document.getElementById("root")),B()}},[[54,1,2]]]);
//# sourceMappingURL=main.887c2f2e.chunk.js.map